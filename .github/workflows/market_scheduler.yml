name: Miniko Stock Bot

on:
  schedule:
    # ğŸ•’ æ™‚é–“éƒ½æ˜¯ UTC (å°ç£æ™‚é–“è¦æ¸› 8 å°æ™‚)
    # 1. æ—©ç­: å°ç£ 08:40 (UTC 00:40) -> è² è²¬ç›¤ä¸­ç›£æ§ + 13:31 æ”¶ç›¤å ±å‘Š
    - cron: '40 0 * * 1-5'
    
    # 2. æ™šç­: å°ç£ 16:50 (UTC 08:50) -> è² è²¬ 17:01 ç±Œç¢¼æˆ°å ±
    - cron: '50 8 * * 1-5'

  # å…è¨±æ‰‹å‹•æŒ‰æŒ‰éˆ•æ¸¬è©¦
  workflow_dispatch:
    inputs:
      mode:
        description: 'æ‰‹å‹•åŸ·è¡Œæ¨¡å¼'
        required: true
        default: 'monitor'
        type: choice
        options:
        - monitor
        - report

jobs:
  run-bot:
    runs-on: ubuntu-latest
    # è¨­å®šæœ€é•·åŸ·è¡Œæ™‚é–“ (GitHub é è¨­ 360 åˆ†é˜ï¼Œæˆ‘å€‘è¨­å¥½è¨­æ»¿)
    timeout-minutes: 360 

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'  # âœ… å·²ä¿®æ­£ï¼šå‡ç´šåˆ° 3.11 ä»¥æ”¯æ´æœ€æ–°ç‰ˆ yfinance

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
        pip install yfinance pandas numpy requests

    - name: Run Miniko Bot
      env:
        # è«‹ç¢ºä¿ä½ åœ¨ GitHub Settings -> Secrets è£¡æœ‰è¨­å®šé€™å…©å€‹è®Šæ•¸
        TG_TOKEN: ${{ secrets.TG_TOKEN }}
        TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
        # è¨­å®šæ™‚å€ç‚ºå°åŒ—
        TZ: Asia/Taipei
      run: |
        python cloud_bot.py monitor

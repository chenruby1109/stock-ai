name: Miniko Stock Bot

on:
  schedule:
    # ç›¤ä¸­ç›£æ§ï¼šé€±ä¸€è‡³é€±äº” UTC 01:00 ~ 05:30 (æ¯15åˆ†)
    - cron: '*/15 1-5 * * 1-5'
    # ç›¤å¾Œå ±å‘Šï¼šé€±ä¸€è‡³é€±äº” UTC 06:30
    - cron: '30 6 * * 1-5'
    
  # ğŸ”¥ æ–°å¢é€™è£¡ï¼šæ‰‹å‹•è§¸ç™¼æ™‚ï¼Œè·³å‡ºé¸å–®è®“ä½ é¸
  workflow_dispatch:
    inputs:
      mode:
        description: 'è«‹é¸æ“‡åŸ·è¡Œæ¨¡å¼'
        required: true
        default: 'report'
        type: choice
        options:
        - report
        - monitor

jobs:
  run-bot:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.9'
        
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        
    - name: Run Bot
      env:
        TG_TOKEN: ${{ secrets.TG_TOKEN }}
        TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
      run: |
        # é‚è¼¯åˆ¤æ–·ï¼š
        # 1. å¦‚æœæ˜¯ã€Œæ‰‹å‹• (workflow_dispatch)ã€ï¼Œå°±è®€å–ä½ é¸çš„æ¨¡å¼
        # 2. å¦‚æœæ˜¯ã€Œè‡ªå‹•æ’ç¨‹ (schedule)ã€ï¼Œå°±çœ‹æ™‚é–“æ±ºå®š
        
        if [ "${{ github.event_name }}" == "workflow_dispatch" ]; then
          echo "ğŸ‘‰ æ‰‹å‹•è§¸ç™¼æ¨¡å¼ï¼š${{ github.event.inputs.mode }}"
          python cloud_bot.py ${{ github.event.inputs.mode }}
        else
          HOUR=$(date -u +%H)
          if [ "$HOUR" -eq "06" ]; then
            echo "â° è‡ªå‹•æ’ç¨‹ï¼šç›¤å¾Œå ±å‘Šæ™‚é–“"
            python cloud_bot.py report
          else
            echo "â° è‡ªå‹•æ’ç¨‹ï¼šç›¤ä¸­ç›£æ§æ™‚é–“"
            python cloud_bot.py monitor
          fi
        fi
